<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>5. Computational Motor Control: Dynamics</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="title" content="5. Computational Motor Control: Dynamics"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="fall 2012"/>
<meta name="author" content="Paul Gribble &amp; Dinant Kistemaker"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style><link rel="stylesheet" type="text/css" href="mystyle.css" />
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up" style="text-align:right;font-size:70%;white-space:nowrap;">
 <a accesskey="h" href="http://www.gribblelab.org/compneuro/4_Computational_Motor_Control_Kinematics.html"> UP </a>
 |
 <a accesskey="H" href="http://www.gribblelab.org/compneuro/index.html"> HOME </a>
</div>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">5. Computational Motor Control: Dynamics</h1>



<hr/>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Introduction</a></li>
<li><a href="#sec-2">Equations of motion for a one-joint arm</a>
<ul>
<li><a href="#sec-2-1">Euler-Lagrange Equation</a></li>
<li><a href="#sec-2-2">Kinetic Energy \(T\)</a>
<ul>
<li><a href="#sec-2-2-1">Linear kinetic energy</a></li>
<li><a href="#sec-2-2-2">Rotational kinetic energy</a></li>
</ul>
</li>
<li><a href="#sec-2-3">Potential Energy \(U\)</a></li>
<li><a href="#sec-2-4">Lagrangian \(L\)</a></li>
<li><a href="#sec-2-5">Equation of motion</a></li>
<li><a href="#sec-2-6">Forward vs Inverse Dynamics</a></li>
<li><a href="#sec-2-7">Simulating the dynamics of the one-joint arm</a></li>
</ul>
</li>
<li><a href="#sec-3">Equations of motion for a two-joint arm</a>
<ul>
<li><a href="#sec-3-1">Kinetic Energy</a>
<ul>
<li><a href="#sec-3-1-1">Linear kinetic energy</a></li>
<li><a href="#sec-3-1-2">Rotational kinetic energy</a></li>
</ul>
</li>
<li><a href="#sec-3-2">Potential energy</a></li>
<li><a href="#sec-3-3">Lagrangian</a></li>
<li><a href="#sec-3-4">Equations of Motion</a>
<ul>
<li><a href="#sec-3-4-1">Joint Interaction Torques</a></li>
<li><a href="#sec-3-4-2">Inverse vs Forward Dynamics Equations of Motion</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<hr/>


<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Introduction</h2>
<div class="outline-text-2" id="text-1">


<p>
Here we will talk about deriving the <b>equations of motion</b> for a
one-joint and then two-joint (planar) arm. We saw in earlier topics
how to translate differential equations into Python code for
simulation. Here we will be talking about how to derive the equations
themselves. Then we will implement them in Python, and simulate the
dynamical behaviour of the arm. For now we will still leave out
muscles, and only talk about the dynamics of the arm linkage
itself. Surprisingly, even a "simple" two-joint arm ends up having
complex dynamical behaviour.
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">Equations of motion for a one-joint arm</h2>
<div class="outline-text-2" id="text-2">


<p>
Let's start with a simple one-joint planar arm (like an elbow joint),
and let's put it in a vertical plane, with gravity acting down:
</p>

<div class="figure">
<p><img src="figs/elbow_dynamics.png" width="400px" align="center" alt="figs/elbow_dynamics.png" /></p>
<p>Schematic of a simple one-joint arm in a vertical plane</p>
</div>

<p>
We have a single link of length \(l\) that is represented as a uniform
rod of length \(l\) metres, with centre of mass \(m\) kg located \(r\)
metres from the origin (about which the link rotates), and with
rotational <a href="http://en.wikipedia.org/wiki/Moment_of_inertia">moment of inertia</a> \(i\) (kgm\(^{2}\)). The angle \(\theta\) is
the angle between the horizontal and the link, and we have the force
of gravity \(g\) acting in the downward direction.
</p>
<p>
There are many ways of deriving the equations of motion of a dynamical
system, including the <a href="http://en.wikipedia.org/wiki/Lagrangian_mechanics">Lagrangian</a>, <a href="http://en.wikipedia.org/wiki/Hamiltonian_mechanics">Hamiltonian</a>, and <a href="http://en.wikipedia.org/wiki/Newtonâ€“Euler_equations">Newton-Euler</a>
approaches. They are all different ways to get to the same place (for
our purposes), the equations of motion relating the inputs
(e.g. forces and torques) to the dynamical behaviour (accelerations,
velocities, positions) of a system. We will look at the Lagrangian
approach here. A great practical book for looking at all sorts of
examples of the Lagrangian approach, for all sorts of mechanical
systems, is <a href="http://www.amazon.ca/Schaums-Outline-Lagrangian-Dynamics-Wells/dp/0070692580">Schaum's Outline: Lagrangian Dynamics</a>.
</p>
<p>
<b>Note</b>: if you are squeamish about the calculus, or you're just not
that interested in the nuts and bolts of <i>how</i> to derive equations of
motion, that's OK &hellip; just skip ahead to <a href="http://www.gribblelab.org/compneuro/5_Computational_Motor_Control_Dynamics.html#sec-2-6">here</a> and see what the final
equation of motion looks like.
</p>

</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1">Euler-Lagrange Equation</h3>
<div class="outline-text-3" id="text-2-1">


<p>
The really cool thing about the Lagrangian approach is that you can derive equations of motion using only:
</p>
<ol>
<li>a characterization of the energy (kinetic &amp; potential) of the system
</li>
<li>a description of the kinematics of the system
</li>
<li>running these through calculus
</li>
</ol>


<p>
The Euler-Lagrange equation gives the "generalized" equations of motion
as:
</p>


\begin{equation}
Q_{j} = \frac{d}{dt} \left( \frac{\partial L}{\partial \dot{q_{j}}} \right) - \left( \frac{\partial L}{\partial q_{j}} \right)
\end{equation}

<p>
where \(j\) indexes into each "generalized coordinate", and where
</p>


\begin{equation}
L = T - U
\end{equation}

<p>
and where \(T\) is the <b>kinetic energy</b> of the system, and \(U\) is
the <b>potential energy</b> of the system.
</p>
<p>
The basic idea is once you derive an expression for \(L\), then you just
run it through the derivatives in the Euler-Lagrange equation, to get
the equations of motion in terms of the "generalized forces"
\(Q_{j}\). I know that sounds a bit opaque, so let's run through a
concrete example with our single-joint pendulum.
</p>
<p>
Let's derive the two parts of \(L\) (\(T\) and \(U\)) and then we will see
how to get the equations of motion by running \(L\) through the
Euler-Lagrange equation to get generalized forces \(Q_{j}\).
</p>
</div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2">Kinetic Energy \(T\)</h3>
<div class="outline-text-3" id="text-2-2">


<p>
So first let's write down the <a href="http://en.wikipedia.org/wiki/Kinetic_energy">kinetic energy</a> \(T\). There are two parts:
the linear kinetic energy of the centre of mass \(m\), and the
rotational kinetic energy of the rod.
</p>

</div>

<div id="outline-container-2-2-1" class="outline-4">
<h4 id="sec-2-2-1">Linear kinetic energy</h4>
<div class="outline-text-4" id="text-2-2-1">


<p>
We know that for a point mass (and we are representing our link's
centre of mass as a point mass \(m\) kg located \(\frac{l}{2}\) metres
away from a rotary joint), the kinetic energy is \(\frac{1}{2}mv^{2}\)
where \(v\) is velocity:
</p>


\begin{eqnarray}
T_{lin} &= &\frac{1}{2} m v^{2}\\
T_{lin} &= &\frac{1}{2} m (\dot{x}^{2} + \dot{y}^{2})\\
T_{lin} &= &\frac{1}{2} m \dot{x}^{2} + \frac{1}{2} m \dot{y}^{2}
\end{eqnarray}

</div>

</div>

<div id="outline-container-2-2-2" class="outline-4">
<h4 id="sec-2-2-2">Rotational kinetic energy</h4>
<div class="outline-text-4" id="text-2-2-2">


<p>
For rotation, kinetic energy is:
</p>


\begin{equation}
T_{rot} = \frac{1}{2} i \dot{\theta}^{2}
\end{equation}

<p>
where \(i\) is the moment of inertia and \(\dot{\theta}\) is the angular
velocity.
</p>
<p>
Putting them together, the total kinetic energy of the system is:
</p>


\begin{equation}
T = \frac{1}{2} m \dot{x}^{2} + \frac{1}{2} m \dot{y}^{2} + \frac{1}{2} i \dot{\theta}^{2}
\end{equation}

<p>
We can transform the coordinates from extrinsic \((x,y)\) (location of
centre of mass) to intrinsic \(\theta\) using the following relations,
which we know from geometry:
</p>


\begin{eqnarray}
x &= &r \sin\theta\\
y &= &-r \cos\theta
\end{eqnarray}

<p>
so if we substitute and simplify terms (not shown) we get:
</p>


\begin{equation}
T = \frac{1}{2} m r^{2} \dot{\theta}^{2} + \frac{1}{2} i \dot{\theta}^{2}
\end{equation}

</div>
</div>

</div>

<div id="outline-container-2-3" class="outline-3">
<h3 id="sec-2-3">Potential Energy \(U\)</h3>
<div class="outline-text-3" id="text-2-3">


<p>
Now let's write down the <a href="http://en.wikipedia.org/wiki/Potential_energy">potential energy</a> \(U\). We know from basic
physics that in general, the potential energy for a mass in earth's
gravitational field is:
</p>


\begin{equation}
U = m g h
\end{equation}

<p>
where \(m\) is mass (kg), \(g\) is the gravitational constant (9.81 m/s)
and \(h\) is the height "above the ground". So for our rotating arm,
let's define the "zero potential energy point" (like the "ground")
when the pendulum is pointing straight down, i.e. when \(\theta = 0\):
</p>


\begin{equation}
U = m g r \left( 1-\cos\theta \right)
\end{equation}

</div>

</div>

<div id="outline-container-2-4" class="outline-3">
<h3 id="sec-2-4">Lagrangian \(L\)</h3>
<div class="outline-text-3" id="text-2-4">


<p>
So now we have the Lagrangian \(L = T-U\) is:
</p>


\begin{equation}
L = T-U = \frac{1}{2} m r^{2} \dot{\theta}^{2} + \frac{1}{2} i \dot{\theta}^{2} - m g r \left( 1-\cos\theta \right)
\end{equation}

<p>
So to summarize, we have chosen our <b>generalized coordinates</b> to be in
terms of the joint angle \(\theta\). Since we only have one degree of
freedom in our system, in fact we only have one generalized
coordinate, which is \(\theta\). The generalized forces \(Q_{j}\) are just
one, so we will write \(Q\), and since we chose our generalized
coordinate to be angular, \(\theta\), our generalized force \(Q\) is
actually a <a href="http://en.wikipedia.org/wiki/Torque">torque</a> (the rotational equivalent of a force).
</p>
</div>

</div>

<div id="outline-container-2-5" class="outline-3">
<h3 id="sec-2-5">Equation of motion</h3>
<div class="outline-text-3" id="text-2-5">


<p>
Now it's a matter of computing the derivative terms in the
Euler-Lagrange equation to get an expression giving the torque of the
system in terms of the system states. You can do this by hand if
you're a calculus ninja, or use a symbolic computing package like
SymPy to do it for you.
</p>


\begin{equation}
\frac{\partial L}{\partial \theta} = -m g r \sin \theta
\end{equation}

<p>
and
</p>


\begin{equation}
\frac{\partial L}{\partial \dot{\theta}} = \dot{\theta} \left( i + m r^{2} \right)
\end{equation}

<p>
and
</p>


\begin{equation}
\frac{d}{dt} \left( \frac{\partial L}{\partial \dot{\theta}}  \right) = 
\ddot{\theta} \left( i + m r^{2} \right)
\end{equation}

<p>
and remember the Euler-Lagrange equation:
</p>


\begin{equation}
Q_{j} = \frac{d}{dt} \left( \frac{\partial L}{\partial \dot{q_{j}}} \right) - \left( \frac{\partial L}{\partial q_{j}} \right)
\end{equation}

<p>
so plugging in the values from the calculus/algebra above,
</p>


\begin{equation}
Q = \ddot{\theta} \left( i + m r^{2}  \right) + m g r \sin\theta
\end{equation}

<p>
So this is our <b>equation of motion</b>, it gives us a relationship
between generalized force \(Q\) (which is a <b>torque</b>), and the <b>states of the system</b>, \((\theta,\dot{\theta},\ddot{\theta})\) (note actually
\(\dot{\theta}\) doesn't appear in our equations of motion in this case).
</p>
</div>

</div>

<div id="outline-container-2-6" class="outline-3">
<h3 id="sec-2-6">Forward vs Inverse Dynamics</h3>
<div class="outline-text-3" id="text-2-6">


<p>
Our equation of motion:
</p>


\begin{equation}
Q = \ddot{\theta} \left( i + m r^{2}  \right) + m g r \sin\theta
\end{equation}

<p>
where \(Q\) is joint torque (Nm), \(m\) is link mass (kg), \(l\) is link
length (m), \(g\) is gravitational constant (m/s/s) and \(\theta\) is
joint angle (radians), gives <b>joint torque as a function of state</b>.
</p>
<p>
This is actually the <i>inverse dynamics</i> equation. To say it
differently, this is the equation we can use to answer the question,
"what torque do I need at the joint (for example from muscles) in
order to generate a given dynamic state?"
</p>
<p>
For forward simulation of a dynamical system, we need the <i>forward dynamics</i> equation of motion. In other words, we need an equation that
gives the derivatives of the system state(s) as a function of the
system states themselves (and any other quantities, e.g. joint
torque).
</p>
<p>
We can easily solve our equation of motion for \(\ddot{\theta}\):
</p>


\begin{equation}
\ddot{\theta} = \frac{Q - mgr\sin\theta}{i + mr^{2}}
\end{equation}

<p>
Note that if the torque \(Q\) is zero, in other words if there is no <b>input</b> torque to the system, then:
</p>


\begin{equation}
\ddot{\theta} = \frac{- mgr\sin\theta}{i + mr^{2}}
\end{equation}

<p>
This characterizes the passive dynamics of the system (the dynamical
behaviour of the system in the absence of any external driving
torque).
</p>
<p>
If you want to see the SymPy code for doing all this calculus, it is
here: <a href="code/onejoint_lagrange.py">onejoint_lagrange.py</a>
</p>
</div>

</div>

<div id="outline-container-2-7" class="outline-3">
<h3 id="sec-2-7">Simulating the dynamics of the one-joint arm</h3>
<div class="outline-text-3" id="text-2-7">


<p>
Let's write a function, as we did earlier in the course for other systems, for the forward dynamics of our one-joint arm:
</p>



<pre class="src src-python"><span style="color: #af00ff;">from</span> scipy.integrate <span style="color: #af00ff;">import</span> odeint
<span style="color: #af00ff;">def</span> <span style="color: #0000ff;">onejointarm</span>(state,t):
   theta = state[0]      <span style="color: #af0000;"># joint angle (rad)</span>
   theta_dot = state[1]  <span style="color: #af0000;"># joint velocity (rad/s)</span>
   m = 1.65              <span style="color: #af0000;"># kg</span>
   r = 0.50              <span style="color: #af0000;"># link length (m)</span>
   g = 9.81              <span style="color: #af0000;"># gravitational constant (m/s/s)</span>
   i = 0.025             <span style="color: #af0000;"># moment of inertia (kg m m)</span>
   theta_ddot = -(m*g*r*sin(theta)) / (i + (m*r*r))
   <span style="color: #af00ff;">return</span> [theta_dot, theta_ddot]

<span style="color: #af5f00;">t</span> = linspace(0.0,10.0,1001)   <span style="color: #af0000;"># 10 seconds sampled at 1000 Hz</span>
<span style="color: #af5f00;">state0</span> = [90.0*pi/180.0, 0.0] <span style="color: #af0000;"># 90 deg initial angle, 0 deg/sec initial velocity</span>
<span style="color: #af5f00;">state</span> = odeint(onejointarm, state0, t)

figure()
plot(t,state*180/pi)
legend((<span style="color: #87005f;">'theta'</span>,<span style="color: #87005f;">'thetadot'</span>))
xlabel(<span style="color: #87005f;">'TIME (sec)'</span>)
ylabel(<span style="color: #87005f;">'THETA (deg) &amp; THETA_DOT (deg/sec)'</span>)
</pre>



<div class="figure">
<p><img src="figs/onejointarm_passive.png" width="600px" align="center" alt="figs/onejointarm_passive.png" /></p>
<p>Dynamics of passive one-joint arm</p>
</div>

<p>
Here's a little function that will animate the arm:
</p>



<pre class="src src-python"><span style="color: #af00ff;">def</span> <span style="color: #0000ff;">animate_arm</span>(state,t):
   l = 0.5
   figure(figsize=(12,6))
   plot(0,0,<span style="color: #87005f;">'r.'</span>)
   p, = plot((0,l*sin(state[0,0])),(0,-l*cos(state[0,0])),<span style="color: #87005f;">'b-'</span>)
   tt = title(<span style="color: #87005f;">"%4.2f sec"</span> % 0.00)
   xlim([-l-.05,l+.05])
   ylim([-l,.10])
   step = 3
   <span style="color: #af00ff;">for</span> i <span style="color: #af00ff;">in</span> <span style="color: #875f87;">xrange</span>(1,shape(state)[0]-10,step):
      p.set_xdata((0,l*sin(state[i,0])))
      p.set_ydata((0,-l*cos(state[i,0])))
      tt.set_text(<span style="color: #87005f;">"%4.2f sec"</span> % (i*0.01))
      draw()

animate_arm(state,t)
</pre>



<div class="figure">
<p><img src="figs/onejointanimation.png" width="600px" align="center" alt="figs/onejointanimation.png" /></p>
<p>Animation of passive one-joint arm</p>
</div>

</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">Equations of motion for a two-joint arm</h2>
<div class="outline-text-2" id="text-3">


<p>
To derive the equations of motion for a two-jointarm arm we will
follow the same basic steps as above for the one-joint arm.
</p>

<div class="figure">
<p><img src="figs/twojointarm_dynamics.png" width="500px" align="center" alt="figs/twojointarm_dynamics.png" /></p>
<p>Schematic of a two-joint arm in a vertical plane</p>
</div>

<p>
Now we have two links of length \(l_{1}\) and \(l_{2}\) metres, each
represented as a uniform rod of mass \(m_{1}\) and \(m_{2}\) kg, with the
centres of mass located \(r_{1}\) and \(r_{2}\) metres from the points of
rotation. Moments of inertia (not shown on figure) are \(i_{1}\) and
\(i_{2}\). The shoulder joint is located at the origin, \((0,0)\) metres,
the elbow joint \(E\) at \((e_{x},e_{y})\) and the hand \(H\) at
\((h_{x},h_{y})\). Gravity \(g\) is pointing "down" \((-y)\) and joint
angles \((\theta_{1},\theta_{2})\) are as indicated.
</p>
<p>
As before we will be using the Euler-Lagrange equation to derive the equations of motion:
</p>


\begin{equation}
Q_{j} = \frac{d}{dt} \left( \frac{\partial L}{\partial \dot{q_{j}}} \right) - \left( \frac{\partial L}{\partial q_{j}} \right)
\end{equation}

<p>
where \(j={1,2}\) (see below) and where
</p>


\begin{equation}
L = T - U
\end{equation}

<p>
Here we will have two generalized coordinates \(\theta_{1}\) and
\(\theta_{2}\), and so our generalized forces \(Q_{1}\) and \(Q_{2}\) will
correspond to shoulder torque and elbow torque, respectively.
</p>
<p>
<b>Note</b> If you want to skip over the Lagrangian formulation you are
welcome to, just skip right <a href="http://www.gribblelab.org/compneuro/5_Computational_Motor_Control_Dynamics.html#sec-3-4">here</a> to the equations of motion.
</p>


</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1">Kinetic Energy</h3>
<div class="outline-text-3" id="text-3-1">


<p>
Again we must write expressions for linear and rotational kinetic energy.
</p>

</div>

<div id="outline-container-3-1-1" class="outline-4">
<h4 id="sec-3-1-1">Linear kinetic energy</h4>
<div class="outline-text-4" id="text-3-1-1">


<p>
In general,
</p>


\begin{equation}
Tlin_{j} = \frac{1}{2} m_{j} v_{j}^{2}
\end{equation}

<p>
for \(j={1,2}\). Expanding \(v_{j}\):
</p>


\begin{eqnarray}
Tlin_{1} &= &\frac{1}{2} m_{1} \left( \dot{x_{1}}^{2} + \dot{y_{1}}^{2} \right)\\
Tlin_{2} &= &\frac{1}{2} m_{2} \left( \dot{x_{2}}^{2} + \dot{y_{2}}^{2} \right)\\
\end{eqnarray}

</div>

</div>

<div id="outline-container-3-1-2" class="outline-4">
<h4 id="sec-3-1-2">Rotational kinetic energy</h4>
<div class="outline-text-4" id="text-3-1-2">


<p>
For rotation, kinetic energy is:
</p>


\begin{equation}
Trot_{j} = \frac{1}{2} i_{j} \dot{\theta_{j}}^{2}
\end{equation}

<p>
so
</p>


\begin{eqnarray}
Trot_{1} &= &\frac{1}{2} i_{1} \dot{\theta_{1}}^{2}\\
Trot_{2} &= &\frac{1}{2} i_{2} \left(\dot{\theta_{1}}+ \dot{\theta_{2}}\right)^{2}\\
\end{eqnarray}

<p>
We can transform the coordinates from external \((x,y)\) cartesian
coordinates into our chosen (intrinsic, joint-based) generalized
coordinate frame \((\theta_{1},\theta_{2})\) based on the following
relations from geometry (our forward kinematic equations):
</p>


\begin{eqnarray}
x_{1} &= &r_{1} \sin \theta_{1}\\
y_{1} &= &-r_{1} \cos \theta_{1}\\
x_{2} &= &l_{1} \sin \theta_{1} + r_{2} \sin \left( \theta_{1}+\theta_{2} \right)\\
y_{2} &= &-l_{1} \cos \theta_{1} - r_{2} \cos \left( \theta_{1}+\theta_{2} \right)
\end{eqnarray}

<p>
Total kinetic energy is then:
</p>


\begin{eqnarray}
T &= &Tlin_{1} + Tlin_{2} + Trot_{1} + Trot_{2}\\
\end{eqnarray}

</div>
</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2">Potential energy</h3>
<div class="outline-text-3" id="text-3-2">


<p>
Just as for the onejoint arm we have potential energy of each link.
</p>


\begin{eqnarray}
U_{1} &= &m_{1} g r_{1}(1-\cos\theta_{1})\\
U_{2} &= &m_{2} g \left( l_{1}(1-\cos\theta_{1}) + r_{2}(1-\cos(\theta_{1}+\theta_{2}))  \right)
\end{eqnarray}

</div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3">Lagrangian</h3>
<div class="outline-text-3" id="text-3-3">


<p>
We then define the lagrangian \(L\) as
</p>


\begin{eqnarray}
L &= &T - U\\
L &= &Tlin_{1} + Tlin_{2} + Trot_{1} + Trot_{2} - U_{1} - U{2}
\end{eqnarray}

<p>
To get the equations of motion we then simply evaluate the
Euler-Lagrange equation, once for each generalized force (torque):
</p>


\begin{eqnarray}
Q_{1} &= &\frac{d}{dt} \left( \frac{\partial L}{\partial \dot{\theta_{1}}} \right) - \left( \frac{\partial L}{\partial \theta_{1}} \right)\\
Q_{2} &= &\frac{d}{dt} \left( \frac{\partial L}{\partial \dot{\theta_{2}}} \right) - \left( \frac{\partial L}{\partial \theta_{2}} \right)
\end{eqnarray}

</div>

</div>

<div id="outline-container-3-4" class="outline-3">
<h3 id="sec-3-4">Equations of Motion</h3>
<div class="outline-text-3" id="text-3-4">


<p>
What we end up with (I won't take you step by through all the
calculus) is two equations of motion, one for shoulder torque \(Q_{1}\)
and one for elbow torque \(Q_{2}\).
</p>


\begin{eqnarray}
Q_{1} &= &M_{11} \ddot{\theta_{1}} + M_{12} \ddot{\theta_{2}} + C_{1} + G_{1}\\
Q_{2} &= &M_{21} \ddot{\theta_{1}} + M_{22} \ddot{\theta_{2}} + C_{2} + G_{2}\\
\end{eqnarray}

<p>
where
</p>


\begin{eqnarray}
M_{11} &= &i_{1} + i_{2} + m_{1}r_{1}^{2} + m_{2}\left( l_{1}^{2} + r_{2}^{2} + 2 l_{1} r_{2} \cos\theta_{2} \right)\\
M_{12} &= M_{21} = &i_{2} + m_{2} \left(r_{2}^{2} + l_{1} r_{2} \cos\theta_{2} \right)\\
M_{22} &= &i_{2} + m_{2} r_{2}^{2}
\end{eqnarray}

<p>
and
</p>


\begin{eqnarray}
C_{1} &= &- m_{2} l_{1} \dot{\theta_{2}}^{2} r_{2} \sin\theta_{2} - 2 m_{2}  l_{1} \dot{\theta_{1}}\dot{\theta_{2}} r_{2} \sin\theta_{2}\\
C_{2} &= &m_{2}  l_{1} \dot{\theta_{1}}^{2} r_{2} \sin\theta_{2}
\end{eqnarray}

<p>
and
</p>


\begin{eqnarray}
G_{1} &= &g \sin\theta_{1} \left(m_{2}l_{1} + m_{1}r_{1} \right) + g m_{2} r_{2} \sin(\theta_{1}+\theta_{2})\\
G_{2} &= &g m_{2} r_{2} \sin(\theta_{1}+\theta_{2})
\end{eqnarray}

<p>
The \(M\) terms you can think of as inertial terms (they depend on joint
accelerations). The \(C\) terms are usually called
<i>Coriolis-centrifugal</i> terms, and the \(G\) terms are the terms due to
gravity.
</p>

</div>

<div id="outline-container-3-4-1" class="outline-4">
<h4 id="sec-3-4-1">Joint Interaction Torques</h4>
<div class="outline-text-4" id="text-3-4-1">


<p>
Notice something interesting about these two-joint arm equations of
motion: The torque at the shoulder \(Q_{1}\) depends not just on
shoulder acceleration \(\ddot{\theta_{1}}\) but also on elbow joint
acceleration \(\ddot{\theta_{2}}\). Similarly, elbow joint torque
\(Q_{2}\) depends not just on elbow joint acceleration
\(\ddot{\theta_{2}}\) but also on shoulder joint acceleration
\(\ddot{\theta_{1}}\). These are inertial interaction torques.
</p>
<p>
If you look at the Coriolis/centrifugal terms \(C\) you also see a
similar pattern but for velocities. Shoulder torque \(Q_{1}\) depends
(via \(C_{1}\)) on <i>elbow velocity</i> \(\dot{\theta_{2}}\) and on the product
of shoulder and elbow velocities
\(\dot{\theta_{1}}\dot{theta_{2}}\). Elbow torque \(Q_{2}\) depends (via
\(C_{2}\)) on shoulder velocity squared \(\dot{\theta_{1}}^{2}\). These are
Coriolis-centrifugal interaction torques.
</p>
<p>
So when torque at one joint depends on velocities and/or accelerations
at another joint, we call these effects <b>joint interaction torques</b>.
</p>
</div>

</div>

<div id="outline-container-3-4-2" class="outline-4">
<h4 id="sec-3-4-2">Inverse vs Forward Dynamics Equations of Motion</h4>
<div class="outline-text-4" id="text-3-4-2">


<p>
The equations above are inverse dynamics equations: they give the
shoulder and elbow joint torques required (for example by muscles) to
generate a particular arm kinematic trajectory.
</p>
<p>
To get the forward dynamics equations of motion, we just need to do a little bit of algebra. Let's first write our inverse dynamics equations from above, in matrix form:
</p>


\begin{equation}
Q = M \ddot{\theta} + C + G
\end{equation}

<p>
where
</p>


\begin{eqnarray}
M &= &\left[ \begin{array}{cc} M_{11} &M_{12}\\ M_{21} & M_{22}  \end{array} \right]\\
\ddot{\theta} &= &\left[ \begin{array}{cc} \ddot{\theta_{1}}\\\ddot{\theta_{2}} \end{array} \right] \\
C &= &\left[ \begin{array}{cc} C_{1}\\C_{2} \end{array} \right] \\
G &= &\left[ \begin{array}{cc} G_{1}\\G_{2} \end{array} \right]
\end{eqnarray}

<p>
Now to change our equation into a forward dynamics equation, we simply
need to solve for \(\ddot{\theta}\):
</p>


\begin{equation}
\ddot{\theta} = \left( M^{-1} \right) \left( Q-C-G \right)
\end{equation}

<p>
and for a passive arm with no external (driving) torques (e.g. from muscles) this simplifies to:
</p>


\begin{equation}
\ddot{\theta} = \left( M^{-1} \right) \left( -C-G \right)
\end{equation}

<p>
Here is a Python function that implements the forward dynamics equations of a passive two-joint arm:
</p>



<pre class="src src-python"><span style="color: #af00ff;">def</span> <span style="color: #0000ff;">twojointarm</span>(state,t,aparams):
        <span style="color: #87005f;">"""</span>
<span style="color: #87005f;">        passive two-joint arm in a vertical plane</span>
<span style="color: #87005f;">        X is fwd(+) and back(-)</span>
<span style="color: #87005f;">        Y is up(+) and down(-)</span>
<span style="color: #87005f;">        gravity acts down</span>
<span style="color: #87005f;">        shoulder angle a1 relative to Y vert, +ve counter-clockwise</span>
<span style="color: #87005f;">        elbow angle a2 relative to upper arm, +ve counter-clockwise</span>
<span style="color: #87005f;">        """</span>
        a1,a2,a1d,a2d = state
        l1,l2 = aparams[<span style="color: #87005f;">'l1'</span>], aparams[<span style="color: #87005f;">'l2'</span>]
        m1,m2 = aparams[<span style="color: #87005f;">'m1'</span>], aparams[<span style="color: #87005f;">'m2'</span>]
        i1,i2 = aparams[<span style="color: #87005f;">'i1'</span>], aparams[<span style="color: #87005f;">'i2'</span>]
        r1,r2 = aparams[<span style="color: #87005f;">'r1'</span>], aparams[<span style="color: #87005f;">'r2'</span>]
        g = 9.81
        M11 = i1 + i2 + (m1*r1*r1) + (m2*((l1*l1) + (r2*r2) + (2*l1*r2*cos(a2))))
        M12 = i2 + (m2*((r2*r2) + (l1*r2*cos(a2))))
        M21 = M12
        M22 = i2 + (m2*r2*r2)
        M = matrix([[M11,M12],[M21,M22]])
        C1 = -(m2*l1*a2d*a2d*r2*sin(a2)) - (2*m2*l1*a1d*a2d*r2*sin(a2))
        C2 = m2*l1*a1d*a1d*r2*sin(a2)
        C = matrix([[C1],[C2]])
        G1 = (g*sin(a1)*((m2*l1)+(m1*r1))) + (g*m2*r2*sin(a1+a2))
        G2 = g*m2*r2*sin(a1+a2)
        G = matrix([[G1],[G2]])
        ACC = inv(M) * (-C-G)
        a1dd,a2dd = ACC[0,0],ACC[1,0]
        <span style="color: #af00ff;">return</span> [a1d, a2d, a1dd, a2dd]
</pre>


<p>
Here is a python program that will do a forward simulation of our
passive two-joint arm, starting from specified initial shoulder and
elbow joint angles and velocities. It will also show a rudimentary
animation of the resulting motion of the arm.
</p>
<p>
<a href="code/twojointarm_passive.py">twojointarm_passive.py</a>
</p>
<p>
[ next ]
</p></div>
</div>
</div>
</div>
</div>

<div id="postamble">
<hr />Paul Gribble &amp; Dinant Kistemaker | fall 2012<br>This <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" rel="dct:type">work</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a><br><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" /></a><br />
</div>
</body>
</html>
